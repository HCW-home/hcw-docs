<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Install on Debian/Ubuntu - HCW@Home documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Install on Debian/Ubuntu";
        var mkdocs_page_input_path = "debian.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> HCW@Home documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Deployment</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../deploy/">Concept</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Install on Debian/Ubuntu</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#external-repository-setup">External repository setup</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#install-redis">Install Redis</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#install-antivirus">Install antivirus</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#install-coturn-server">Install coturn server</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#install-hcwhome-repository-and-package">Install HCW@Home repository and package</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#install-and-configure-web-server">Install and configure web server</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#configure-hcwhome">Configure HCW@Home</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#create-first-admin-account">Create first admin account</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#install-media-server-with-mediasoup">Install Media server with Mediasoup</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#mediasoup-declaration-in-hcwhome">Mediasoup declaration in HCW@Home</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../docker/">Install with Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../customize/">Customize HCW@Home</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../keycloak/">Configure with Keycloak</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../api/">API documentation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bruno/">Debug API with Bruno</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">HCW@Home documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Deployment &raquo;</li>
      <li>Install on Debian/Ubuntu</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="debianubuntu-installation">Debian/Ubuntu installation</h1>
<h2 id="external-repository-setup">External repository setup</h2>
<p>HCW@Home relies on third party repositories as there is no recent version of mongo or nodejs into official repositories.</p>
<pre><code>apt install curl gnupg ca-certificates lsb-release

# NodeJS Repository
NAME=nodejs
VERSION=16
KEY_URL=&quot;https://deb.nodesource.com/gpgkey/nodesource.gpg.key&quot;
APT_URL=&quot;https://deb.nodesource.com/node_${VERSION}.x $(lsb_release -sc) main&quot;
PACKAGE=nodejs

curl -fsSL ${KEY_URL} | gpg -o /etc/apt/trusted.gpg.d/${PACKAGE}.gpg --dearmor
echo &quot;deb [signed-by=/etc/apt/trusted.gpg.d/${PACKAGE}.gpg] ${APT_URL}&quot; &gt; /etc/apt/sources.list.d/${NAME}.list
apt update
apt install ${PACKAGE}

# MongoDB Repository
NAME=mongodb
VERSION=6.0
DIST_NAME=$(lsb_release -si)
COMPONENT=$(if [ ${DIST_NAME} == &quot;Ubuntu&quot; ] ; then echo &quot;multiverse&quot; ; else echo &quot;main&quot; ; fi )
KEY_URL=&quot;https://www.mongodb.org/static/pgp/server-${VERSION}.asc&quot;
APT_URL=&quot;http://repo.mongodb.org/apt/${DIST_NAME,} $(lsb_release -sc)/mongodb-org/${VERSION} ${COMPONENT}&quot;
PACKAGE=mongodb-org

curl -fsSL ${KEY_URL} | gpg -o /etc/apt/trusted.gpg.d/${PACKAGE}.gpg --dearmor
echo &quot;deb [signed-by=/etc/apt/trusted.gpg.d/${PACKAGE}.gpg] ${APT_URL}&quot; &gt; /etc/apt/sources.list.d/${NAME}.list
apt update
apt install ${PACKAGE}
systemctl enable --now mongod
</code></pre>
<p>After those commands are done, you should have up and running mongo service.</p>
<h2 id="install-redis">Install Redis</h2>
<p>Redis is an on memory database, it's used to temporary store information like session. Installation of redis server must be shared between backends (if several one are deployed), but we are assuming here we are installing on one server. The installation is very simple:</p>
<pre><code>apt install redis-server
</code></pre>
<h2 id="install-antivirus">Install antivirus</h2>
<p>Antivirus limits the risk to propagate malware through HCW@Home. It will check any attachments give by patient or doctor during the consultation. Antivirus can be install on same server or on external server.</p>
<pre><code>apt install clamav-daemon
</code></pre>
<p>Check that service is up.</p>
<pre><code>systemctl start clamav-daemon
systemctl status clamav-daemon
</code></pre>
<h2 id="install-coturn-server">Install coturn server</h2>
<p>Coturn is an open-source project that provides a TURN and STUN server implementation. Both TURN and STUN are protocols that help in NAT traversal for WebRTC applications.</p>
<p>Coturn setup can be achieve in different mode, we assume that we are installing on same server than Backend, but it's strongly recommanded to install on different server.</p>
<pre><code>apt install coturn
</code></pre>
<p>Now adjust the file /etc/turnserver.conf like this.</p>
<pre><code># Enable only if your server is behind a NAT.
external-ip=&lt;you machine ip&gt;

# Adjust only if you want to use another port.
listening-port=3478

# Ensure to enable fingerprint and long term credential.
fingerprint
lt-cred-mech

# Adjust the port range that turn is allowed to use. The port range must be opened from the
# firewall as UDP and TCP.
max-port=65535
min-port=49152

# Choose a realm, can be formatted like iabsis.com
realm=&lt;domain&gt;

# Configure a user and a password, this is required to be 
# allowed to use the turn relay capabilities. &lt;user&gt;:&lt;password&gt;
user=myuser:mypass
</code></pre>
<p>If you don't want to put clear password in configuration file, you can encode the password with the following command.</p>
<pre><code>turnadmin -k -u &lt;user&gt; -r &lt;realm&gt; -p &lt;pass&gt;
</code></pre>
<p>This command returns an encoded password starting by 0xabc..., replace mypass by the returned value, ensure to keep 0x in front of the password.</p>
<pre><code>user=myuser:0xabc...
</code></pre>
<p>Keep in mind this user and password configured here as it will be used later by Mediasoup server.</p>
<h2 id="install-hcwhome-repository-and-package">Install HCW@Home repository and package</h2>
<p>HCW@Home is composed of four main components:</p>
<ul>
<li>One Backend</li>
<li>One Frontend dedicated for Doctors</li>
<li>One Frontend dedicated for Patient</li>
<li>One Frontend dedicated for Administrators</li>
</ul>
<p>Those components can be installed on same server or on differents one. Here we will explain how to install on same server.</p>
<pre><code>cat &gt; /etc/apt/sources.list.d/hcw.list &lt;&lt; EOF
deb [arch=amd64 trusted=yes] https://projects.iabsis.com/repository/hcw-backend/debian focal main
deb [arch=amd64 trusted=yes] https://projects.iabsis.com/repository/hcw-patient/debian focal main
deb [arch=amd64 trusted=yes] https://projects.iabsis.com/repository/hcw-doctor/debian focal main
deb [arch=amd64 trusted=yes] https://projects.iabsis.com/repository/hcw-admin/debian focal main
EOF
</code></pre>
<p>Now, refresh the list of packages with the following command.</p>
<pre><code>apt update
</code></pre>
<p>Finally, you can install the thre component on one command</p>
<pre><code>apt install hcw-athome-patient hcw-athome-backend hcw-athome-caregiver hcw-athome-admin
</code></pre>
<h2 id="install-and-configure-web-server">Install and configure web server</h2>
<p>Now you have an up and running HCW@Home system, you must install a web server. We tested Nginx web server even if it should work with others like Apache.</p>
<p>Installation of Nginx is straight forward</p>
<pre><code>apt install nginx
</code></pre>
<p>If you don't have reverse proxy server in front of your Nginx, you might need to install certbot for issuing SSL certificates. You can install the following package</p>
<pre><code>apt install python3-certbot-nginx
</code></pre>
<p>By default, HCW@Home doesn't install Nginx configuration, but you can use the ready configuration from doc folder. Don't forget to adjust the configuration based on your needs.</p>
<pre><code>wget https://raw.githubusercontent.com/HCW-home/frontend-patient/master/nginx-docker.conf.template -O /etc/nginx/sites-enabled/hcw-patient.conf
wget https://raw.githubusercontent.com/HCW-home/frontend-patient/master/nginx-docker.conf.template -O /etc/nginx/sites-enabled/hcw-doctor.conf
wget https://raw.githubusercontent.com/HCW-home/frontend-patient/master/nginx-docker.conf.template -O /etc/nginx/sites-enabled/hcw-admin.conf
rm /etc/nginx/sites-enabled/default
</code></pre>
<p>Update the files :</p>
<pre><code>listen       80;
server_name  &lt;replace by your domain&gt;;
root   /usr/share/hcw-athome/admin; # or patient or caregiver for depending of config file you are updating;
...
proxy_pass http://127.0.0.1:1337; # Update 127.0.0.1 if installed on same server, or different IP if separate sever.
</code></pre>
<p>The last command removes the fallback default configuration provided by Nginx.</p>
<p>If you now want to issue certificate, run the following command and follow the usual cerbot process. If you need more information about this process, read the official documentation: https://certbot.eff.org/</p>
<pre><code>certbot --nginx
</code></pre>
<h2 id="configure-hcwhome">Configure HCW@Home</h2>
<p>Now that every component are ready, we can update the main configuration file /etc/hcw-athome/hcw-athome.conf. Most of the part are self explanatory, you are free to adjust according to your specific configuration.</p>
<p>Also adjust the socket or port Clamav can be reached. If you use socket, you might need to first add HCW@Home system user to Clamav group to be able to communicate with the Daemon.</p>
<pre><code>adduser hcwhome clamav
</code></pre>
<p>Check now the socket path, by default it should be /var/run/clamav/clamd.ctl, so you can adjust this path in HCW@home configuration with this command.</p>
<pre><code>sed -i 's|/var/run/clamd.scan/clamd.sock|/var/run/clamav/clamd.ctl|g' /etc/hcw-athome/hcw-athome.conf
</code></pre>
<p>Once updated, you can restart and check for logs with the following commands.</p>
<pre><code>systemctl enable --now hcw-athome
or
systemctl restart hcw-athome
</code></pre>
<p>Check logs</p>
<pre><code>journalctl -f -u hcw-athome -n 200
</code></pre>
<p>If you see the following line, it means your server is ready.</p>
<pre><code>Aug 23 13:15:33 hcw-athome-dev node[546330]: debug: -------------------------------------------------------
Aug 23 13:15:33 hcw-athome-dev node[546330]: debug: :: Wed Aug 23 2023 13:15:33 GMT+0000 (Coordinated Universal Time)
Aug 23 13:15:33 hcw-athome-dev node[546330]: debug: Environment : production
Aug 23 13:15:33 hcw-athome-dev node[546330]: debug: Port        : 1337
Aug 23 13:15:33 hcw-athome-dev node[546330]: debug: -------------------------------------------------------
</code></pre>
<h2 id="create-first-admin-account">Create first admin account</h2>
<p>You must have a least one admin account before being able to login on the admin interface (then being able to create other user). Create the first user with mongo request.</p>
<pre><code>mongosh
use hcw-athome;
db.user.insertOne({email:&quot;admin@example.com&quot;,  firstName:&quot;Admin&quot;, lastName:&quot;&quot;,  role: &quot;admin&quot;,  createdAt: new Date().getTime(), password: &quot;$2b$10$uip0TKwn.kbO1s1C3jO0au4ymxjkgd.kg9ueH2oV02I4gJBKzH.2m&quot;, &quot;updatedAt&quot;: new Date().getTime(), &quot;username&quot; : &quot;admin@example.com&quot;, phoneNumber: &quot;&quot;})
</code></pre>
<p>This command will create user with login "admin@example.com" and password "admin".</p>
<p>If you need to customize this passsword and you have nodejs installed (or you do on your server), you can use the following script, by example into password.js, don't forgot to update 'not hashed password'.</p>
<pre><code>const bcrypt = require('bcrypt');

bcrypt.hash('not hashed password', 10, function(err, hash) {
  if(err) console.log(err)
  console.log(hash);
});
</code></pre>
<p>You will need to install bcrypt with the following command.</p>
<pre><code>npm install bcrypt
</code></pre>
<p>Then run the script with:</p>
<pre><code>node password.js
</code></pre>
<h2 id="install-media-server-with-mediasoup">Install Media server with Mediasoup</h2>
<p>Mediasoup is a media server used to send flow between participant.</p>
<pre><code>cat &gt; /etc/apt/sources.list.d/mediasoup.list &lt;&lt; EOF
deb [trusted=yes] https://projects.iabsis.com/repository/mediasoup-api/debian bullseye main
EOF
</code></pre>
<p>Refresh the list of available package.</p>
<pre><code>apt update
</code></pre>
<p>Now install the package</p>
<pre><code>apt install mediasoup-api
</code></pre>
<p>Now adjust the file /etc/mediasoup-api/mediasoup-api.conf, don't forgot to define the following lines with your coturn configuration previously defined.</p>
<pre><code>TURN_SERVER1=turn:turn.example.com/?transport=udp
TURN_USERNAME1=myuser
TURN_PASSWORD1=mypwd
</code></pre>
<p>Most values are self explanatory, once you done your changes, restart the service with the following command.</p>
<pre><code>systemctl status mediasoup-api
</code></pre>
<p>If you prefer want to serve Mediasoup API with Nginx (recommanded), you can create a new Nginx file (by example /etc/nginx/sites-enabled/mediasoup.conf) and use the following template.</p>
<pre><code>map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
}

server {
    server_name &lt;domain&gt;;

    location / {
        proxy_set_header Host $host;
        proxy_pass https://localhost:3443;
        proxy_set_header X-Forwarded-For $remote_addr;

        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;

        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Port $server_port;

        proxy_connect_timeout 120m;
        proxy_send_timeout 120m;
        proxy_read_timeout 120m;
    }

    listen 80;
}
</code></pre>
<p>Don't forget to update the <domain> part. If you need to issue certbot certificate, use again the following command.</p>
<pre><code>certbot --nginx
</code></pre>
<h2 id="mediasoup-declaration-in-hcwhome">Mediasoup declaration in HCW@Home</h2>
<p>If you have only one mediasoup server, you can simply configure it into HCW@Home configuration file.</p>
<pre><code>#/etc/hcw-athome/hcw-athome.conf
MEDIASOUP_URL=https://&lt;replace-by-my-domain&gt;
MEDIASOUP_USER=abcd
MEDIASOUP_SECRET=1234
</code></pre>
<p>If you have more than one server, you can add all from admin interface from "Mediasoup" menu.</p>
<p><img alt="alt text" src="../image.png" /></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../deploy/" class="btn btn-neutral float-left" title="Concept"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../docker/" class="btn btn-neutral float-right" title="Install with Docker">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../deploy/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../docker/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
